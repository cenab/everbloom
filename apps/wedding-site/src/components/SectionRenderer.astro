---
import type { RenderConfig } from '../types';
import HeroSection from './sections/HeroSection.astro';
import EventDetailsSection from './sections/EventDetailsSection.astro';
import RsvpSection from './sections/RsvpSection.astro';
import PhotoUploadSection from './sections/PhotoUploadSection.astro';
import FaqSection from './sections/FaqSection.astro';
import RegistrySection from './sections/RegistrySection.astro';
import AccommodationsSection from './sections/AccommodationsSection.astro';
import GuestbookSection from './sections/GuestbookSection.astro';
import MusicRequestSection from './sections/MusicRequestSection.astro';

interface Props {
  config: RenderConfig;
}

const { config } = Astro.props;
const { sections, theme, wedding, features, faq, registry, accommodations, guestbook } = config;

// Filter enabled sections and sort by order
const enabledSections = sections
  .filter((section) => section.enabled)
  .sort((a, b) => a.order - b.order);
---

{enabledSections.map((section) => {
  switch (section.type) {
    case 'hero':
      return <HeroSection section={section} theme={theme} />;
    case 'event-details':
      return (
        <EventDetailsSection
          section={section}
          theme={theme}
          weddingDate={wedding.date}
          venue={wedding.venue}
          city={wedding.city}
          slug={wedding.slug}
          calendarEnabled={features.CALENDAR_INVITE}
          eventDetails={config.eventDetails}
        />
      );
    case 'rsvp':
      // Only render RSVP if the feature is enabled
      if (features.RSVP) {
        return <RsvpSection section={section} theme={theme} slug={wedding.slug} />;
      }
      return null;
    case 'photo-upload':
      if (features.PHOTO_UPLOAD) {
        return <PhotoUploadSection section={section} theme={theme} slug={wedding.slug} />;
      }
      return null;
    case 'faq':
      if (features.FAQ_SECTION) {
        return <FaqSection section={section} theme={theme} faq={faq} />;
      }
      return null;
    case 'registry':
      if (features.REGISTRY) {
        return <RegistrySection section={section} theme={theme} registry={registry} />;
      }
      return null;
    case 'accommodations':
      if (features.ACCOMMODATIONS) {
        return <AccommodationsSection section={section} theme={theme} accommodations={accommodations} />;
      }
      return null;
    case 'guestbook':
      if (features.GUESTBOOK) {
        return <GuestbookSection section={section} theme={theme} guestbook={guestbook} weddingSlug={wedding.slug} />;
      }
      return null;
    case 'music-request':
      if (features.MUSIC_REQUESTS) {
        return <MusicRequestSection section={section} theme={theme} slug={wedding.slug} />;
      }
      return null;
    default:
      return null;
  }
})}
